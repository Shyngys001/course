<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>原始点 академиясы — Денсаулыққа арналған онлайн курстар</title>
  <meta name="description" content="原始点 академиясы: қауіпсіз табиғи әдістерді үйреніп, денсаулықты жақсартыңыз. Онлайн курстар, Kaspi арқылы төлеу, қолдау WhatsApp-та.">
  <meta name="theme-color" content="#008000">
  <meta name="color-scheme" content="light only">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <style>
    /* ===== CSS Variables ===== */
    :root {
      --brand: #008000;
      --brand-dark: #006600;
      --brand-light: #E8F5E8;
      --accent: #0984E3;
      --success: #00B894;
      --warning: #FDCB6E;
      --error: #FF6B6B;
      
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8F9FA;
      --bg-card: #FFFFFF;
      --bg-overlay: rgba(0, 0, 0, 0.5);
      
      --text-primary: #2D3436;
      --text-secondary: #636E72;
      --text-muted: #B2BEC3;
      
      --border: #DFE6E9;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
      --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.05);
      
      --radius: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      
      --spacing: 16px;
      --spacing-sm: 12px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      
      --header-height: 64px;
      --tabbar-height: 72px;
      --safe-area-bottom: env(safe-area-inset-bottom, 0px);
      
      --transition: all 0.3s ease;
    }

    /* Dark theme */
    .theme-dark {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2d2d2d;
      --bg-card: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --text-muted: #666666;
      --border: #404040;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.4);
      --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.2);
      --bg-overlay: rgba(0, 0, 0, 0.7);
    }

    /* ===== Reset & Base ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      font-size: 16px;
      overflow-x: hidden;
      transition: var(--transition);
      padding-bottom: var(--tabbar-height);
    }

    /* ===== App Structure ===== */
    .app {
      min-height: 100vh;
      position: relative;
    }

    .page {
      display: none;
      min-height: 100vh;
      /* padding-bottom: calc(var(--tabbar-height) + var(--safe-area-bottom) + 20px); */
    }

    .page.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing);
    }

    /* ===== Header ===== */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
      height: var(--header-height);
      box-shadow: var(--shadow-sm);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
      padding: 0 var(--spacing);
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--brand);
    }

    .header-title i {
      color: var(--brand);
    }

    .back-button {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      border-radius: var(--radius);
      background: var(--bg-secondary);
      border: none;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }

    .back-button:hover {
      background: var(--bg-primary);
    }

    /* ===== Tab Bar ===== */
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--bg-primary);
      border-top: 1px solid var(--border);
      height: calc(var(--tabbar-height) + var(--safe-area-bottom));
      padding-bottom: var(--safe-area-bottom);
      display: flex;
      box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.08);
    }

    .tab-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 11px;
      font-weight: 500;
      min-height: 44px;
      padding: 8px 4px;
      position: relative;
      transition: var(--transition);
      background: none;
      border: none;
      cursor: pointer;
    }

    .tab-item i {
      font-size: 20px;
      margin-bottom: 2px;
      transition: var(--transition);
    }

    .tab-item.active {
      color: var(--brand);
    }

    .tab-item.active i {
      color: var(--brand);
      transform: translateY(-2px);
    }

    .tab-item.active::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 3px;
      background: var(--brand);
      border-radius: 2px;
    }

    /* ===== Common Components ===== */
    .section {
      padding: var(--spacing-xl) 0;
    }

    .section-title {
      margin-bottom: var(--spacing-lg);
    }

    .section-title h2 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .section-title p {
      color: var(--text-secondary);
      font-size: 15px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      border-radius: var(--radius);
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      font-family: inherit;
      font-size: 15px;
    }

    .btn-primary {
      background: var(--brand);
      color: white;
      box-shadow: 0 4px 12px rgba(0, 128, 0, 0.25);
    }

    .btn-primary:hover {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 128, 0, 0.3);
    }

    .btn-secondary {
      background: var(--bg-primary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-secondary);
      transform: translateY(-2px);
    }

    .btn-block {
      width: 100%;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid var(--border);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-4px);
    }

    /* ===== Hero ===== */
    .hero {
      padding: var(--spacing-xl) 0;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid var(--border);
    }

    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 300px;
      height: 300px;
      background: var(--brand-light);
      border-radius: 50%;
      opacity: 0.3;
    }

    .hero::after {
      content: '';
      position: absolute;
      bottom: -30%;
      left: -10%;
      width: 200px;
      height: 200px;
      background: var(--brand-light);
      border-radius: 50%;
      opacity: 0.2;
    }

    .hero-content {
      text-align: center;
      max-width: 800px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .hero-badge {
      display: inline-block;
      padding: 6px 16px;
      background: var(--brand-light);
      color: var(--brand);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: var(--spacing);
      border: 1px solid rgba(0, 128, 0, 0.1);
    }

    .hero h1 {
      font-size: 32px;
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: var(--spacing);
      color: var(--text-primary);
    }

    .hero h1 span {
      color: var(--brand);
    }

    .hero p {
      font-size: 18px;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xl);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .hero-actions {
      display: flex;
      gap: var(--spacing);
      justify-content: center;
      flex-wrap: wrap;
    }

    /* ===== Courses Grid ===== */
    .academy-modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 60px;
    }

    @media (max-width: 768px) {
      .academy-modules-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    .academy-card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      height: 100%;
      position: relative;
      border: none;
    }

    .academy-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-lg);
    }

    .academy-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
    }

    .academy-card-image {
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      background: #f8fafc;
    }

    /* Картинка как фон для карточки */
.academy-card-image.is-image {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* Лёгкий затемняющий градиент поверх картинки (красиво читается текст) */
.academy-card-image.is-image::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.35));
}

/* Чтобы контент внутри был поверх */
.academy-card-image > * {
  position: relative;
  z-index: 1;
}

    .module-bg {
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      height: 180px;
      position: relative;
    }

    .module-label {
      font-size: 1.3rem;
      font-weight: 700;
      text-align: center;
      padding: 0 15px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .academy-card:hover .academy-card-image img {
      transform: scale(1.08);
    }

    .academy-card-content {
      padding: 24px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .academy-card-content h3 {
      color: var(--brand-dark);
      margin-bottom: 16px;
      font-size: 1.3rem;
      font-weight: 700;
      position: relative;
      display: inline-block;
    }

    .academy-card-content h3::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--brand);
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    .academy-card:hover .academy-card-content h3::after {
      width: 60px;
    }

    .academy-card-content p {
      color: var(--text-secondary);
      margin-bottom: 20px;
      flex-grow: 1;
      line-height: 1.6;
      font-size: 0.95rem;
    }

    .lesson-bg {
      background: linear-gradient(135deg, var(--brand-light), var(--brand));
    }

    .lesson-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--brand);
      color: #fff;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.5rem;
      box-shadow: var(--shadow);
      z-index: 2;
    }

    /* ===== Lessons ===== */
    .lesson-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: var(--spacing);
      border: 1px solid var(--border);
      margin-bottom: var(--spacing);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      flex-direction: column;
    }

    .lesson-card:hover {
      background: var(--bg-secondary);
      transform: translateY(-4px);
    }

    .lesson-header {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing);
      margin-bottom: var(--spacing);
    }

    .lesson-number-sm {
      width: 40px;
      height: 40px;
      background: var(--brand);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      flex-shrink: 0;
    }

    .lesson-info {
      flex: 1;
    }

    .lesson-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .lesson-duration {
      font-size: 14px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .lesson-description {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
    }

    /* ===== Video Player ===== */
    .video-player-page {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      display: flex;
      flex-direction: column;
    }

    .video-header {
      padding: var(--spacing);
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-sm);
    }

    .video-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing);
      position: relative;
    }

    .video-title-container {
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
      max-width: 800px;
    }

    .video-title-container h2 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
      text-align: center;
    }

    .video-iframe-container {
      width: 100%;
      max-width: 800px;
      position: relative;
    }

    .video-iframe {
      width: 100%;
      aspect-ratio: 16/9;
      border: none;
      border-radius: var(--radius);
      background: black;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .video-navigation {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 800px;
      margin-top: 20px;
    }

    .comments-section {
      padding: var(--spacing);
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }

    .comment-form {
      margin-bottom: var(--spacing);
    }

    .comment-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-family: inherit;
      margin-bottom: var(--spacing);
      resize: vertical;
      min-height: 80px;
      font-size: 15px;
    }

    .comment-input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(0, 128, 0, 0.1);
    }

    .comments-list {
      display: grid;
      gap: var(--spacing);
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .comment-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: var(--spacing);
      border-left: 3px solid var(--brand);
      box-shadow: var(--shadow-sm);
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .comment-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: white;
      font-weight: 600;
    }

    .comment-author {
      font-weight: 600;
      color: var(--text-primary);
    }

    .comment-date {
      font-size: 12px;
      color: var(--text-muted);
    }

    .comment-text {
      color: var(--text-secondary);
      line-height: 1.5;
      font-size: 15px;
    }

    /* ===== FAQ ===== */
    .faq-accordion {
      display: grid;
      gap: var(--spacing);
    }

    .faq-item {
      background: var(--bg-card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .faq-question {
      padding: var(--spacing);
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-primary);
      transition: var(--transition);
    }

    .faq-question:hover {
      background: var(--bg-secondary);
    }

    .faq-question i {
      transition: transform 0.3s ease;
      color: var(--text-muted);
    }

    .faq-item.active .faq-question i {
      transform: rotate(180deg);
      color: var(--brand);
    }

    .faq-answer {
      padding: 0 var(--spacing);
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .faq-item.active .faq-answer {
      padding: 0 var(--spacing) var(--spacing);
      max-height: 500px;
    }

    /* ===== Profile ===== */
    .profile-header {
      text-align: center;
      padding: var(--spacing-xl) 0;
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%);
      color: white;
      border-radius: 0 0 var(--radius-xl) var(--radius-xl);
      margin-bottom: var(--spacing-xl);
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgb(255, 255, 255);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 32px;
      border: 3px solid rgba(255, 255, 255, 0.3);
    }

    .profile-name {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .profile-email {
      font-size: 14px;
      opacity: 0.9;
    }

    .profile-stats{
  display:grid;
  grid-template-columns: repeat(2, 1fr); /* бұрын 3 еді */
  gap:16px;
}
    .stat-item {
      text-align: center;
      padding: var(--spacing);
      background: var(--bg-card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--brand);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    /* ===== Modal ===== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-overlay);
      backdrop-filter: blur(8px);
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing);
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      width: 100%;
      max-width: 400px;
      transform: translateY(20px);
      transition: var(--transition);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      margin-bottom: var(--spacing-lg);
      text-align: center;
    }

    .modal-header h3 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .modal-header p {
      color: var(--text-secondary);
      font-size: 15px;
    }

    .form-group {
      margin-bottom: var(--spacing);
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 15px;
      transition: var(--transition);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(0, 128, 0, 0.1);
    }

    /* ===== Loading & Error ===== */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-xl);
      color: var(--text-secondary);
      grid-column: 1 / -1;
      text-align: center;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--brand);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--spacing);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .error-message {
      text-align: center;
      padding: 60px 20px;
      color: var(--error);
      grid-column: 1 / -1;
      background: var(--bg-card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .error-message i {
      font-size: 3rem;
      margin-bottom: 20px;
      color: var(--error);
    }

    .error-message h3 {
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    /* ===== Utility ===== */
    .text-center {
      text-align: center;
    }
    
    .mb {
      margin-bottom: var(--spacing);
    }
    
    .mt {
      margin-top: var(--spacing);
    }

    .fade-in {
      animation: fadeIn 0.7s ease forwards;
      opacity: 0;
    }

    /* ===== Notification ===== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      z-index: 9999;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      max-width: 400px;
      font-weight: 600;
    }

    .notification-success {
      background: var(--success);
      color: white;
    }

    .notification-error {
      background: var(--error);
      color: white;
    }

    .notification-info {
      background: var(--accent);
      color: white;
    }

    /* ===== Footer ===== */
    .app-footer {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      padding: 30px 0;
      margin-top: 40px;
    }

    .footer-content {
      text-align: center;
      color: var(--text-secondary);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .footer-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: var(--transition);
    }

    .footer-link:hover {
      color: var(--brand);
    }

    .footer-copyright {
      font-size: 13px;
      opacity: 0.8;
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 28px;
      }
      
      .hero p {
        font-size: 16px;
      }
      
      .section {
        padding: var(--spacing-lg) 0;
      }
      
      .section-title h2 {
        font-size: 22px;
      }
      
      .hero-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .academy-modules-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .profile-stats {
        grid-template-columns: 1fr;
      }

      .video-iframe {
        border-radius: var(--radius);
      }

      .video-title-container h2 {
        font-size: 20px;
      }

      .footer-links {
        flex-direction: column;
        gap: 10px;
      }
      
      .video-navigation {
        flex-direction: column;
        gap: 10px;
      }
      
      .video-navigation .btn {
        width: 100%;
      }
    }

    @media (min-width: 769px) {
      .tab-bar {
        display: flex;
      }
      
      .academy-modules-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .academy-modules-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    /* ===== Custom Modal ===== */
    .custom-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-overlay);
      backdrop-filter: blur(8px);
      z-index: 3001;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing);
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .custom-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .custom-modal-content {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      width: 100%;
      max-width: 500px;
      transform: translateY(20px);
      transition: var(--transition);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }

    .custom-modal.active .custom-modal-content {
      transform: translateY(0);
    }


    /* ===== Segmented Tabs (Ақылы / Бонус) ===== */
.segment-tabs{
  display:flex;
  gap:12px;
  margin:12px 0 18px;
  align-items:center;
}
.segment-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--bg-card);
  color:var(--text-secondary);
  font-weight:700;
  cursor:pointer;
  transition: var(--transition);
}
.segment-btn i{ opacity:.85; }
.segment-btn.active{
  background: rgba(0,128,0,.12);
  border-color: rgba(0,128,0,.35);
  color: var(--brand);
}
.segment-btn.active i{ opacity:1; }

/* ===== News list ===== */
.news-top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}

.news-views{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background: var(--bg-secondary);
  color: var(--text-muted);
  font-weight:800;
  font-size:12px;
  white-space:nowrap;
}

.news-views i{
  font-size:12px;
  opacity:.85;
}

.news-list{ display:grid; gap:14px; }
.news-item{
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 16px;
  box-shadow: var(--shadow-sm);
}
.news-title{ font-weight:800; margin-bottom:6px; }
.news-date{ color: var(--text-muted); font-size:12px; margin-bottom:10px; }
.news-text{ color: var(--text-secondary); line-height:1.6; }

/* ===== Segmented Tabs (Ақылы / Бонус) — BIG + CENTER ===== */
.segment-tabs{
  display:flex;
  justify-content:center;      /* ✅ центр */
  align-items:center;
  gap:14px;
  margin:16px 0 22px;
  width:100%;
}

.segment-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;

  /* ✅ үлкейту */
  padding:14px 22px;
  min-height:48px;
  min-width:140px;

  border-radius:999px;
  border:1px solid var(--border);
  background:var(--bg-card);
  color:var(--text-secondary);
  font-weight:800;
  font-size:16px;

  cursor:pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
}

.segment-btn i{
  font-size:16px;
  opacity:.9;
}

.segment-btn:hover{
  transform: translateY(-1px);
}

.segment-btn.active{
  background: rgba(0,128,0,.14);
  border-color: rgba(0,128,0,.45);
  color: var(--brand);
  box-shadow: 0 6px 18px rgba(0,128,0,.16);
}

.segment-btn.active i{ opacity:1; }

/* ✅ мобайлда толық енімен, екеуі тең */
@media (max-width: 480px){
  .segment-tabs{
    gap:10px;
    padding: 0 6px;
  }
  .segment-btn{
    flex:1;                   /* ✅ 2 батырма тең */
    min-width: 0;
    padding:14px 16px;
  }
}


.news-item{
  cursor: pointer;
  transition: var(--transition);
}
.news-item:hover{
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}
.news-preview{
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.news-links{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:14px;
}
.news-link-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background: var(--bg-secondary);
  color: var(--text-primary);
  text-decoration:none;
  font-weight:700;
}
.news-link-btn:hover{ transform: translateY(-1px); }

/* ===== Auth Gate Modal (locked module) ===== */
.authgate{
  position: fixed;
  inset: 0;
  z-index: 4000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  opacity: 0;
  visibility: hidden;
  transition: .25s ease;
}
.authgate.active{ opacity: 1; visibility: visible; }

.authgate-card{
  width: 100%;
  max-width: 520px;
  border-radius: 22px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
  transform: translateY(14px);
  transition: .25s ease;
}
.authgate.active .authgate-card{ transform: translateY(0); }

.authgate-top{
  padding: 18px 18px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, rgba(0,128,0,.10), rgba(0,128,0,.02));
}
.authgate-brand{
  display:flex; align-items:center; gap:10px;
  font-weight: 900; letter-spacing:.2px;
}
.authgate-brand .ic{
  width: 44px; height:44px; border-radius: 14px;
  display:flex; align-items:center; justify-content:center;
  background: rgba(0,128,0,.14);
  color: var(--brand);
  box-shadow: 0 8px 24px rgba(0,128,0,.14);
}
.authgate-close{
  width: 40px; height:40px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  cursor: pointer;
}
.authgate-close:hover{ transform: translateY(-1px); }

.authgate-body{ padding: 18px; }
.authgate-title{ font-size: 20px; font-weight: 900; margin-bottom: 6px; }
.authgate-sub{ color: var(--text-secondary); line-height:1.6; margin-bottom: 14px; }

.authgate-chiprow{
  display:flex; gap:10px; flex-wrap:wrap;
  margin: 10px 0 14px;
}
.authgate-chip{
  display:inline-flex; align-items:center; gap:8px;
  padding: 8px 12px;
  border-radius: 999px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  font-weight: 800;
  font-size: 12px;
  color: var(--text-secondary);
}

.paybox{
  border: 1px solid var(--border);
  background: var(--bg-secondary);
  border-radius: 16px;
  padding: 14px;
  margin: 12px 0 16px;
}
.payrow{
  display:flex;
  justify-content:space-between;
  gap:12px;
  padding: 10px 0;
  border-bottom: 1px dashed rgba(0,0,0,.08);
}
.theme-dark .payrow{ border-bottom: 1px dashed rgba(255,255,255,.12); }
.payrow:last-child{ border-bottom: 0; }
.payrow b{ font-weight: 900; color: var(--text-primary); }
.payrow span{ color: var(--text-secondary); font-weight: 700; }

.authgate-actions{
  display:flex;
  gap:12px;
  allow-wrap:wrap;
}
.authgate-actions .btn{ flex: 1; }
@media(max-width:480px){
  .authgate-actions{ flex-direction: column; }
}

/* ===== Theme Toggle Switch ===== */
.theme-toggle{
  display:flex;
  align-items:center;
  gap:12px;
}

.theme-label{
  font-weight:800;
  font-size:13px;
  color: var(--text-secondary);
  display:inline-flex;
  align-items:center;
  gap:8px;
  user-select:none;
}

.theme-label.active{
  color: var(--text-primary);
}

.switch{
  position:relative;
  width:56px;
  height:32px;
  display:inline-block;
}

.switch input{
  opacity:0;
  width:0;
  height:0;
}

.slider{
  position:absolute;
  inset:0;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius:999px;
  transition: .25s ease;
  box-shadow: var(--shadow-sm);
}

.slider:before{
  content:"";
  position:absolute;
  height:26px;
  width:26px;
  left:3px;
  top:50%;
  transform: translateY(-50%);
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius:50%;
  transition: .25s ease;
  box-shadow: 0 6px 14px rgba(0,0,0,.10);
}

.switch input:checked + .slider{
  background: rgba(0,128,0,.18);
  border-color: rgba(0,128,0,.45);
}

.switch input:checked + .slider:before{
  transform: translate(24px, -50%);
}

.switch input:focus-visible + .slider{
  outline: 3px solid rgba(0,128,0,.18);
  outline-offset: 2px;
}













/* ================================
   PREMIUM iPhone COPPER SKIN
   (қоя салсаң болды)
================================ */

/* 1) Brand palette (copper) */
:root{
  --brand: #C7772E;        /* copper main */
  --brand-dark: #8E4F1D;   /* copper deep */
  --brand-light: #FFF1E4;  /* warm light */
  --accent: #E39A49;

  --bg-primary:#FFFFFF;
  --bg-secondary:#F6F7F8;
  --bg-card:#FFFFFF;

  --text-primary:#171717;
  --text-secondary:#4A4A4A;
  --text-muted:#8B8B8B;

  --border: rgba(0,0,0,.08);

  --shadow-sm: 0 8px 18px rgba(0,0,0,.06);
  --shadow:    0 16px 34px rgba(0,0,0,.10);
  --shadow-lg: 0 26px 60px rgba(0,0,0,.14);

  --radius: 14px;
  --radius-lg: 18px;
  --radius-xl: 24px;

  --transition: all .22s ease;
}

/* Dark mode copper */
.theme-dark{
  --bg-primary:#0C0B0A;
  --bg-secondary:#151312;
  --bg-card:#161413;

  --text-primary:#FFFFFF;
  --text-secondary:#CFCFCF;
  --text-muted:#8A8A8A;

  --border: rgba(255,255,255,.10);

  --shadow-sm: 0 10px 22px rgba(0,0,0,.45);
  --shadow:    0 18px 40px rgba(0,0,0,.55);
  --shadow-lg: 0 28px 70px rgba(0,0,0,.65);
}

/* 2) App background (soft premium) */
body{
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(199,119,46,.10), transparent 55%),
    radial-gradient(900px 600px at 110% 30%, rgba(227,154,73,.12), transparent 55%),
    linear-gradient(180deg, var(--bg-primary), var(--bg-secondary));
}

/* 3) Header — glass + thin border */
.app-header{
  background: color-mix(in srgb, var(--bg-primary) 82%, transparent);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--border);
  box-shadow: 0 10px 25px rgba(0,0,0,.06);
}
.theme-dark .app-header{
  background: rgba(12,11,10,.72);
  box-shadow: 0 14px 35px rgba(0,0,0,.50);
}
.header-title{
  color: var(--brand);
}

/* 4) Hero — copper glow */
.hero{
  background:
    radial-gradient(900px 500px at 50% -30%, rgba(199,119,46,.22), transparent 60%),
    linear-gradient(135deg, color-mix(in srgb, var(--bg-primary) 90%, #fff), var(--bg-secondary));
    
  border-bottom: 1px solid var(--border);
  
}
.hero-badge{
  background: color-mix(in srgb, var(--brand-light) 70%, white);
  border: 1px solid rgba(199,119,46,.20);
  color: var(--brand-dark);
}

/* 5) Cards — premium edges + glow on hover */
.card, .academy-card, .faq-item, .lesson-card, .news-item{
  border: 1px solid var(--border) !important;
  box-shadow: var(--shadow-sm);
}
.academy-card{
  background: color-mix(in srgb, var(--bg-card) 92%, transparent);
}
.academy-card:hover{
  transform: translateY(-6px);
  box-shadow: var(--shadow-lg);
}
.academy-card::after{
  background: linear-gradient(135deg, var(--brand), #E9B16A);
}

/* 6) Buttons — iPhone-like depth */
.btn{
  border-radius: 16px;
  letter-spacing: .1px;
}
.btn-primary{
  background: linear-gradient(180deg, #E9B16A, var(--brand));
  color: #fff;
  box-shadow: 0 10px 24px rgba(199,119,46,.28);
}
.btn-primary:hover{
  transform: translateY(-2px);
  box-shadow: 0 14px 30px rgba(199,119,46,.34);
}
.btn-secondary{
  background: color-mix(in srgb, var(--bg-card) 86%, transparent);
  border: 1px solid var(--border);
  color: var(--text-primary);
  box-shadow: 0 10px 22px rgba(0,0,0,.06);
}
.btn-secondary:hover{
  background: color-mix(in srgb, var(--bg-secondary) 90%, transparent);
  transform: translateY(-2px);
}

/* 7) Tab bar — premium glass */
.tab-bar{
  background: color-mix(in srgb, var(--bg-primary) 80%, transparent);
  backdrop-filter: blur(16px);
  border-top: 1px solid var(--border);
  box-shadow: 0 -18px 40px rgba(0,0,0,.10);
}
.tab-item.active{
  color: var(--brand);
}
.tab-item.active::after{
  background: linear-gradient(90deg, var(--brand), #E9B16A);
}

/* 8) Segmented tabs (Ақылы/Бонус) */
.segment-btn{
  background: color-mix(in srgb, var(--bg-card) 86%, transparent);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.segment-btn.active{
  background: linear-gradient(180deg, rgba(233,177,106,.28), rgba(199,119,46,.14));
  border-color: rgba(199,119,46,.40);
  color: var(--brand-dark);
}

/* 9) Switch — copper */
.switch input:checked + .slider{
  background: rgba(199,119,46,.22);
  border-color: rgba(199,119,46,.48);
}
.switch input:checked + .slider:before{
  border-color: rgba(199,119,46,.35);
}

/* 10) Little polishing */
.academy-card-content h3{
  color: var(--text-primary);
}
.academy-card-content h3::after{
  background: linear-gradient(90deg, var(--brand), #E9B16A);
}
.news-views{
  background: color-mix(in srgb, var(--bg-secondary) 88%, transparent);
}


.profile-header{
  background: linear-gradient(180deg, #E9B16A, var(--brand));
}





  </style>
</head>
<body>
  <div class="app">
    <!-- Main Page -->
    <div id="mainPage" class="page active">
      <header class="app-header">
        <div class="header-content">
          <div class="header-title">
            <i class="fas fa-heartbeat"></i>
            <span>原始点 академиясы</span>
          </div>
          <div>
            <button class="btn btn-secondary" onclick="showLoginModal()" id="loginButtonHeader">
              <i class="fas fa-sign-in-alt"></i> Кіру
            </button>
          </div>
        </div>
      </header>

      <main>
        <section class="hero">
          <div class="container">
            <div class="hero-content">
              <span class="hero-badge">Себебін тапсаң-шипасы табылады</span>
              <h1>«Себепті нүкте сауықтыру»<br><span>орталығы</span></h1>
              <!-- <p>«Жылуың бар өсесің, өнесің, жылуың жоқ өшесің өлесің»</p> -->
              <div class="hero-actions">
                <!-- <button class="btn btn-primary" onclick="loadModules()">
                  <i class="fas fa-book-open"></i> Курстарды көру
                </button> -->
              </div>
            </div>
          </div>
        </section>

        <section id="modules" class="section">
          <div class="container">
            <div class="section-title">
              <h2>Онлайн курстар</h2>
              <p>Өз жылдамдығыңызбен үйретіңіз. Үйде-ақ меңгеріңіз</p>
            </div>
            <div class="segment-tabs">
                <button class="segment-btn active" id="tabPaid" onclick="setCoursesTab('paid')">
                  <i class="fas fa-lock"></i> Ақылы
                </button>
                <button class="segment-btn" id="tabBonus" onclick="setCoursesTab('bonus')">
                  <i class="fas fa-gift"></i> Бонус
                </button>
              </div>
            <div class="academy-modules-grid" id="coursesContainer">
              <div class="loading">
                <div class="spinner"></div>
                <p>Курстар жүктелуде...</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Footer -->
        <!-- <footer class="app-footer">
          <div class="container">
            <div class="footer-content">
              <div class="footer-links">
                <a href="#" class="footer-link" onclick="showPrivacyPolicy()">Privacy Policy</a>
                <a href="#" class="footer-link" onclick="showTerms()">Terms of Service</a>
              </div>
              <p class="footer-copyright">Махаббатпен, AI-Man Dev компанисымен жасалған</p>
            </div>
          </div>
        </footer> -->
      </main>
    </div>

    <!-- FAQ Page -->
    <div id="faqPage" class="page">
      <header class="app-header">
        <div class="header-content">
          <button class="back-button" onclick="showPage('mainPage')">
            <i class="fas fa-arrow-left"></i>
            Артқа
          </button>
          <div class="header-title">
            <i class="fas fa-question-circle"></i>
            <span>Сұрақ-жауап</span>
          </div>
          <div></div>
        </div>
      </header>

      <main>
        <section class="section">
          <div class="container">
            <div class="section-title">
              <h2>Жиі қойылатын сұрақтар</h2>
              <p>Сіздің барлық сұрақтарыңызға жауап</p>
            </div>
            <div class="faq-accordion">
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  <span>Қалай кірем?</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                  <p>Жоғарыдағы «Кіру» батырмасын басып, нөмір мен құпиясөзді енгізесіз.</p>
                </div>
              </div>
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  <span>Төлемнен кейін қолжетімділік?</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                  <p>Kaspi чегін WhatsApp арқылы жібересіз — менеджер қолжетімділікті бірден қосады.</p>
                </div>
              </div>
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  <span>Видео ашылмаса?</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                  <p>Интернет пен браузер кэшін тексеріңіз немесе бізге жазыңыз.</p>
                </div>
              </div>
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  <span>Курсты қалай сатып аламын?</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                  <p>Курсты таңдап, Kaspi арқылы төлеңіз. Төлемнен кейін чекті менеджерге жіберіңіз.</p>
                </div>
              </div>
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  <span>Қанша уақытқа қолжетімді?</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                  <p>Курсқа төлегеннен кейін 1 жыл бойы шектеусіз қолжетімділік аласыз.</p>
                </div>
              </div>
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  <span>Қауіпсіз бе?</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                  <p>Иә, барлық тәсілдер қауіпсіз және табиғи. Бірақ әрқашан сақтықпен жасаңыз.</p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="page">
      <header class="app-header">
        <div class="header-content">
          <button class="back-button" onclick="showPage('mainPage')">
            <i class="fas fa-arrow-left"></i>
            Артқа
          </button>
          <div class="header-title">
            <i class="fas fa-user"></i>
            <span>Профиль</span>
          </div>
          <div></div>
        </div>
      </header>

      <main>
        <div class="profile-header">
          <div class="profile-avatar" id="profileAvatar">
            <img src="logo.png" style="width: 100%;" alt="">
          </div>
          <div class="profile-name" id="userName">Қонақ</div>
          <div class="profile-email" id="userEmail">Кіру керек</div>
        </div>

        <section class="section">
          <div class="container">
            <!-- <div class="profile-stats">
              <div class="stat-item">
                <div class="stat-value" id="statCourses">0</div>
                <div class="stat-label">Модуль</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="statLessons">0</div>
                <div class="stat-label">Сабақ</div>
              </div>
            </div> -->
            <div class="mb">
              <h3 class="mb">Параметрлер</h3>
              <div class="card">
                <div style="display: flex; flex-direction: column; gap: 16px;">
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span>Тема</span>
                    <div class="theme-toggle">
                      <span class="theme-label" id="themeLabelLeft"><i class="fas fa-sun"></i> Ақ</span>
                    
                      <label class="switch" title="Тема ауыстыру">
                        <input type="checkbox" id="themeToggle" aria-label="Тема ауыстыру">
                        <span class="slider"></span>
                      </label>
                    
                      <span class="theme-label" id="themeLabelRight"><i class="fas fa-moon"></i> Қара</span>
                    </div>
                  </div>
                  <div style="display: none; align-items: center; justify-content: space-between;">
                    <span>Тіл</span>
                    <select class="form-control" style="width: auto; padding: 8px 12px;" id="languageSelect">
                      <option value="kk">Қазақша</option>
                      <option value="ru">Орысша</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb">
              <h3 class="mb">Менің курстарым</h3>
              <div class="card mb" id="myCourses">
                <p style="color: var(--text-secondary); text-align: center; padding: 20px;">Әзірше курс сатып алмадыңыз</p>
              </div>
              <button class="btn btn-primary" onclick="showPage('mainPage')">
                <i class="fas fa-shopping-cart"></i> Курстарды көру
              </button>
            </div>

            

            <div>
              <button class="btn btn-secondary" id="logoutBtn" style="display: none; width: 100%;" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Шығу
              </button>
              <button class="btn btn-primary" id="loginBtn" style="width: 100%;" onclick="showLoginModal()">
                <i class="fas fa-sign-in-alt"></i> Кіру
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Lessons Page -->
    <div id="lessonsPage" class="page">
      <header class="app-header">
        <div class="header-content">
          <button class="back-button" onclick="showPage('mainPage')">
            <i class="fas fa-arrow-left"></i>
            Артқа
          </button>
          <div class="header-title" id="lessonPageTitle">Сабақтар</div>
          <div></div>
        </div>
      </header>

      <main>
        <section class="section">
          <div class="container">
            <div class="section-title">
              <h2 id="moduleTitle">Модуль сабақтары</h2>
              <p id="moduleDescription">Оқу үшін сабақты таңдаңыз</p>
            </div>
            <div class="academy-modules-grid" id="lessonsContainer">
              <div class="loading">
                <div class="spinner"></div>
                <p>Сабақтар жүктелуде...</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>


    <!-- News Page -->
<div id="newsPage" class="page">
    <header class="app-header">
      <div class="header-content">
        <button class="back-button" onclick="showPage('mainPage')">
          <i class="fas fa-arrow-left"></i>
          Артқа
        </button>
        <div class="header-title">
          <i class="fas fa-newspaper"></i>
          <span>Жаңалықтар</span>
        </div>
        <div></div>
      </div>
    </header>
  
    <main>
      <section class="section">
        <div class="container">
          <div class="section-title">
            <h2>Жаңалықтар</h2>
            <p>Жаңартулар мен хабарландырулар</p>
          </div>
  
          <div id="newsContainer" class="news-list">
            <div class="loading">
              <div class="spinner"></div>
              <p>Жаңалықтар жүктелуде...</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- News Detail Page -->
<div id="newsDetailPage" class="page">
  <header class="app-header">
    <div class="header-content">
      <button class="back-button" onclick="showPage('newsPage')">
        <i class="fas fa-arrow-left"></i>
        Артқа
      </button>
      <div class="header-title">
        <i class="fas fa-newspaper"></i>
        <span>Жаңалық</span>
      </div>
      <div></div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container">
        <div class="card" style="border-radius: var(--radius-xl);">
          <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
            <span style="display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; background: rgba(0,128,0,.12); color: var(--brand); font-weight:800; font-size:12px;">
              <i class="fas fa-bell"></i> Хабарландыру
            </span>
            <span id="newsDetailDate" style="color: var(--text-muted); font-size:12px;"></span>
          </div>

          <h2 id="newsDetailTitle" style="font-size:26px; line-height:1.2; margin-bottom:12px;"></h2>

          <div id="newsDetailText" style="color: var(--text-secondary); line-height:1.75; font-size:16px; white-space:pre-line;"></div>

          <div id="newsDetailLinks" style="margin-top:18px; display:none;"></div>
        </div>

        <div style="height: 24px;"></div>
      </div>
    </section>
  </main>
</div>

    <!-- Tab Bar -->
    <nav class="tab-bar">
      <button class="tab-item active" onclick="showPage('mainPage')">
        <i class="fas fa-book"></i>
        <span>Курстар</span>
      </button>
      <button class="tab-item" onclick="showPage('newsPage')">
        <i class="fas fa-newspaper"></i>
        <span>Жаңалықтар</span>
      </button>
      <button class="tab-item" onclick="showPage('faqPage')">
        <i class="fas fa-question-circle"></i>
        <span>FAQ</span>
      </button>
      <button class="tab-item" onclick="showPage('profilePage')">
        <i class="fas fa-user"></i>
        <span>Профиль</span>
      </button>
    </nav>

    <!-- Video Player -->
    <div id="videoPlayerPage" class="video-player-page" style="display: none;">
      <div class="video-header">
        <button class="btn btn-secondary" onclick="closeVideo()">
          <i class="fas fa-times"></i> Жабу
        </button>
        <span id="videoTitle">Бейнесабақ</span>
        <div></div>
      </div>
      <div class="video-content">
        <div class="video-title-container">
          <h2 id="videoLessonTitle">Сабақ атауы</h2>
        </div>
        <div class="video-iframe-container">
          <iframe id="videoPlayer" class="video-iframe" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="video-navigation" id="videoNavigation" style="display: none;">
          <button class="btn btn-secondary" id="prevVideoBtn">
            <i class="fas fa-arrow-left"></i> Алдыңғы видео
          </button>
          <button class="btn btn-secondary" id="nextVideoBtn">
            Келесі видео <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
      <div class="comments-section">
        <h3 class="mb">Пікірлер</h3>
        <div class="comment-form">
          <textarea class="comment-input" id="commentInput" placeholder="Пікіріңізді жазыңыз..."></textarea>
          <button class="btn btn-primary btn-block" onclick="addComment()">
            <i class="fas fa-paper-plane"></i> Жіберу
          </button>
        </div>
        <div class="comments-list" id="commentsList">
          <!-- Comments will load here -->
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Аккаунтқа кіру</h3>
          <p>Курстарға қол жеткізу үшін кіріңіз</p>
        </div>
        <form onsubmit="event.preventDefault(); login()">
          <div class="form-group">
            <label for="phoneInput">Телефон нөмірі</label>
            <input type="tel" class="form-control" id="phoneInput" placeholder="+7 XXX XXX XX XX" required>
          </div>
          <div class="form-group">
            <label for="passwordInput">Құпиясөз</label>
            <input type="password" class="form-control" id="passwordInput" placeholder="Құпиясөз" required>
          </div>
          <button type="submit" class="btn btn-primary btn-block">
            <i class="fas fa-sign-in-alt"></i> Кіру
          </button>
        </form>
        <div style="text-align: center; margin-top: 20px;">
          <p style="color: var(--text-secondary); margin-bottom: 12px;">Немесе әлеуметтік желі арқылы</p>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <a href="https://wa.me/77479894879" target="_blank" class="btn btn-secondary">
              <i class="fab fa-whatsapp"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Modal (for payment etc) -->
    <div class="custom-modal" id="customModal">
      <div class="custom-modal-content" id="customModalContent">
        <!-- Dynamic content -->
      </div>
    </div>
  </div>

  <!-- Auth Gate Modal -->
<div class="authgate" id="authGateModal">
  <div class="authgate-card" role="dialog" aria-modal="true">
    <div class="authgate-top">
      <div class="authgate-brand">
        <div class="ic"><i class="fas fa-lock"></i></div>
        <div>
          <div style="font-size:14px;color:var(--text-secondary);font-weight:800;">ЕСКЕРТУ</div>
          <div style="font-size:16px;color:var(--text-primary);font-weight:900;">Қолжетімділік шектеулі</div>
        </div>
      </div>
      <button class="authgate-close" onclick="hideAuthGate()"><i class="fas fa-times"></i></button>
    </div>

    <div class="authgate-body">
      <div class="authgate-title" id="authGateTitle">Ақылы модуль</div>
      <div class="authgate-sub" id="authGateText">
        Бұл бөлімді көру үшін аккаунтқа кіру керек. Егер курсты әлі сатып алмаған болсаңыз — төмендегі WhatsApp-қа чек жіберіңіз.
      </div>

      <div class="authgate-chiprow">
        <div class="authgate-chip"><i class="fas fa-user-shield"></i> Тек тіркелген қолданушы</div>
        <div class="authgate-chip"><i class="fas fa-eye"></i> Сақталған прогресс</div>
      </div>

      <div class="paybox">
        <div class="payrow"><b>WhatsApp</b><span id="authGateWhatsapp">+7 747 989 4879</span></div>
        <div class="payrow"><b>Kaspi номер</b><span id="authGateKaspiCard">4400 4302 56 17****</span></div>
        <div class="payrow"><b>Kaspi</b><span id="authGateKaspiPhone">+7 *** *** ****</span></div>
        <div class="payrow"><b>QIWI</b><span id="authGateQiwi">+7 *** *** ****</span></div>
      </div>

      <div class="authgate-actions">
        <button class="btn btn-secondary" onclick="goToLoginFromGate()">
          <i class="fas fa-sign-in-alt"></i> Кіру / Тіркелу
        </button>
        <a class="btn btn-primary" id="authGateWaLink" href="https://wa.me/77479894879" target="_blank" rel="noopener">
          <i class="fab fa-whatsapp"></i> WhatsApp-қа жазу
        </a>
      </div>

      <button class="btn btn-secondary btn-block" style="margin-top:12px;" onclick="hideAuthGate()">
        <i class="fas fa-arrow-left"></i> Артқа
      </button>
    </div>
  </div>
</div>

  <script>
    // ===== CONFIGURATION =====
    const SESS_URL = 'https://script.google.com/macros/s/AKfycbwp61ZemVXyhVy3s2CBDYnfWBZaVhmsGiqzG9U4i4KGCoNykLNZrHwQRBny6iaAJusZ/exec';
    const CONFIG = {
      spreadsheetId: '1fBxicZo7HkKXpoUVRtZvc628oG7rxLeSgcIgmruTd5Y',
      sheets: { modules:'Модули', lessons:'Видеоуроки', users:'Юзеры', comments:'comment', news:'Жаңалықтар' }
    };
    const COMMENT_URL = 'https://script.google.com/macros/s/AKfycbwiWkQUZHiw9TcQNcXsQxwHBK-Qi6nzFrXQwEEe_NO-SxjNLNwp2e841WzvoxCrGWny/exec';

    // Для тестирования - если true, то все авторизованные пользователи получают доступ ко всем курсам
    const ALLOW_ALL_COURSES_FOR_LOGGED_IN = true;

    // ===== STATE MANAGEMENT =====
    const state = {
      currentUser: null,
      currentModule: null,
      currentVideo: null,
      currentLessonIndex: 0,
      currentModuleLessons: [],
      modules: [],
      lessonsAll: [],
      comments: {},
      currentPage: 'mainPage',
      lessonsFetchedAt: 0,
      coursesTab: 'paid',
      postLoginAction: null,
      selectedNews: null,
    };

    let sessionTimer = null;

    // ===== DOM ELEMENTS =====
    const DOM = {
      pages: document.querySelectorAll('.page'),
      tabItems: document.querySelectorAll('.tab-item'),
      loginModal: document.getElementById('loginModal'),
      customModal: document.getElementById('customModal'),
      customModalContent: document.getElementById('customModalContent'),
      coursesContainer: document.getElementById('coursesContainer'),
      lessonsContainer: document.getElementById('lessonsContainer'),
      lessonPageTitle: document.getElementById('lessonPageTitle'),
      moduleTitle: document.getElementById('moduleTitle'),
      moduleDescription: document.getElementById('moduleDescription'),
      videoPlayerPage: document.getElementById('videoPlayerPage'),
      videoPlayer: document.getElementById('videoPlayer'),
      videoTitle: document.getElementById('videoTitle'),
      videoLessonTitle: document.getElementById('videoLessonTitle'),
      videoNavigation: document.getElementById('videoNavigation'),
      prevVideoBtn: document.getElementById('prevVideoBtn'),
      nextVideoBtn: document.getElementById('nextVideoBtn'),
      commentInput: document.getElementById('commentInput'),
      commentsList: document.getElementById('commentsList'),
      userName: document.getElementById('userName'),
      userEmail: document.getElementById('userEmail'),
      profileAvatar: document.getElementById('profileAvatar'),
      logoutBtn: document.getElementById('logoutBtn'),
      loginBtn: document.getElementById('loginBtn'),
      loginButtonHeader: document.getElementById('loginButtonHeader'),
      statCourses: document.getElementById('statCourses'),
      statLessons: document.getElementById('statLessons'),
      myCourses: document.getElementById('myCourses'),
      themeSelect: document.getElementById('themeSelect'),
      languageSelect: document.getElementById('languageSelect')
    };

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
      initApp();
    });

    function initApp() {
      // Restore state from localStorage
      restoreState();
      
      // Set theme from localStorage or default
      const savedTheme = localStorage.getItem('theme') || 'light';
      changeTheme(savedTheme);

      const tg = document.getElementById('themeToggle');
      if (tg) {
        tg.checked = (savedTheme === 'dark');
        tg.addEventListener('change', () => {
          changeTheme(tg.checked ? 'dark' : 'light');
          syncThemeLabels();
        });
      }
      syncThemeLabels();
      
      // Set language from localStorage or default
      const savedLang = localStorage.getItem('language') || 'kk';
      DOM.languageSelect.value = savedLang;
      
      // Load modules
      loadModulesWithCounts();
      
      // Check auth
      checkAuth();
      
      // Setup event listeners
      setupEventListeners();
      
      // Setup language change listener
      DOM.languageSelect.addEventListener('change', function() {
        localStorage.setItem('language', this.value);
        showNotification('Тіл өзгерді: ' + this.options[this.selectedIndex].text, 'info');
      });

      // Setup video navigation buttons
      if (DOM.prevVideoBtn) {
        DOM.prevVideoBtn.addEventListener('click', playPrevVideo);
      }
      if (DOM.nextVideoBtn) {
        DOM.nextVideoBtn.addEventListener('click', playNextVideo);
      }
    }

    function setCoursesTab(tab){
    state.coursesTab = tab;

    // кнопки
    const paidBtn = document.getElementById('tabPaid');
    const bonusBtn = document.getElementById('tabBonus');
    if (paidBtn && bonusBtn){
        paidBtn.classList.toggle('active', tab === 'paid');
        bonusBtn.classList.toggle('active', tab === 'bonus');
    }

    // перерисовать модули
    const counts = (state.lessonsAll || []).reduce((a, l) => {
        const m = String(l.module_id);
        a[m] = (a[m] || 0) + 1;
        return a;
    }, {});
    renderModules(state.modules || [], counts);
    }



    // ===== STATE PERSISTENCE =====
    function saveState() {
      const stateToSave = {
        currentPage: state.currentPage,
        currentModule: state.currentModule,
        currentLessonIndex: state.currentLessonIndex,
        currentModuleLessons: state.currentModuleLessons
      };
      localStorage.setItem('appState', JSON.stringify(stateToSave));
    }

    function restoreState() {
      try {
        const savedState = localStorage.getItem('appState');
        if (savedState) {
          const parsedState = JSON.parse(savedState);
          
          // Restore current page
          if (parsedState.currentPage && parsedState.currentPage !== 'mainPage') {
            setTimeout(() => {
              showPage(parsedState.currentPage);
            }, 100);
          }
          
          // Restore module and lessons
          if (parsedState.currentModule) {
            state.currentModule = parsedState.currentModule;
            state.currentModuleLessons = parsedState.currentModuleLessons || [];
            state.currentLessonIndex = parsedState.currentLessonIndex || 0;
          }
        }
      } catch (e) {
        console.error('Күйді қалпына келтіру қатесі:', e);
      }
    }

    // ===== PAGE NAVIGATION =====
    function showPage(pageId) {
      // Update state
      state.currentPage = pageId;
      
      // Save state
      saveState();
      
      // Hide all pages
      DOM.pages.forEach(page => {
        page.classList.remove('active');
      });
      
      // Show target page
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
      }
      
      // Update tab bar
      updateTabBar(pageId);
      
      // Scroll to top
      window.scrollTo(0, 0);
      
      // Handle page-specific logic
      handlePageShow(pageId);
    }

    function updateTabBar(pageId) {
      // Map page to tab
      const pageToTab = {
        'mainPage': 0,
        'newsPage': 1,
        'faqPage': 2,
        'profilePage': 3
      };
      
      const tabIndex = pageToTab[pageId];
      if (tabIndex !== undefined) {
        DOM.tabItems.forEach((tab, index) => {
          tab.classList.toggle('active', index === tabIndex);
        });
      }
    }

    function handlePageShow(pageId) {
      switch(pageId) {
        case 'profilePage':
          updateProfilePage();
          break;
          case 'newsPage':
            loadNews();
            break;
        case 'lessonsPage':
          if (state.currentModule) {
            loadLessons(state.currentModule.id);
          }
          break;
      }
    }


    async function loadNews(){
        const box = document.getElementById('newsContainer');
        if (!box) return;

        box.innerHTML = '<div class="loading"><div class="spinner"></div><p>Жаңалықтар жүктелуде...</p></div>';

        try{
            let news = await fetchSheetData(CONFIG.sheets.news);

            // ✅ тек актив жаңалықтар
            news = (news || []).filter(n => String(n.is_active || '1').trim() !== '0');

            // ✅ жаңа → ескі (date болса)
            news.sort((a,b) => String(b.date||'').localeCompare(String(a.date||'')));

            if (!news.length){
            box.innerHTML = `<div class="news-item"><div class="news-text" style="text-align:center;color:var(--text-muted);">Әзірше жаңалық жоқ</div></div>`;
            return;
            }

            box.innerHTML = news.map((n, idx) => {
            const title = n.title || 'Жаңалық';
            const text  = n.text || '';
            const date  = n.date || '';

            // ✅ news id (Sheet-та id бағанын қойсаң жақсы)
            const newsId = (n.id || '').trim() || String(idx);

            // ✅ A) localStorage view
            const views = getLocalNewsViews(newsId);

            return `
              <div class="news-item" data-news-index="${idx}" data-news-id="${newsId}">
                <div class="news-top">
                  <div class="news-title">${title}</div>
                  <div class="news-views" id="newsViews_${newsId}">
                    <i class="fas fa-eye"></i> <span>${views}</span>
                  </div>
                </div>
                ${date ? `<div class="news-date">${date}</div>` : ``}
                <div class="news-text news-preview">${text}</div>
              </div>
            `;
          }).join('');

          // click handlers
          box.querySelectorAll('.news-item').forEach(el => {
            el.addEventListener('click', () => {
              const i = parseInt(el.dataset.newsIndex, 10);
              openNewsDetail(news[i]);
            });
          });

        }catch(e){
            console.error(e);
            box.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i><h3>Жаңалықтарды жүктеу мүмкін емес</h3></div>`;
        }
    }


    function parseLinks(value){
  // Google Sheet-та link бағанын былай сақтауға болады:
  // 1) бір ғана ссылка: https://....
  // 2) бірнешеу: "Kaspi|https://... , WhatsApp|https://..., Site|https://..."
  // 3) жол-жолымен де болады
  if (!value) return [];
  const raw = String(value).trim();
  if (!raw) return [];

  const parts = raw.split(/\n|,/).map(s => s.trim()).filter(Boolean);

  return parts.map(p => {
    const [title, url] = p.includes('|') ? p.split('|').map(x => x.trim()) : [null, p];
    return { title: title || 'Сілтеме', url };
  }).filter(x => /^https?:\/\//i.test(x.url));
}

function openNewsDetail(newsObj){
  function openNewsDetail(newsObj){
  // ✅ newsId
  const allNews = state.selectedNews ? [] : []; // (ештеңе істемейді, тиме)
  const newsId = (newsObj.id || '').trim() || String(
    (document.querySelector('.news-item[data-news-index]') ? '' : '')
  );

  // ✅ idx fallback дұрыс болу үшін:
  // біз click кезінде newsId-ты data-news-id арқылы аламыз:
  const clicked = event?.currentTarget;
  const realId = clicked?.dataset?.newsId || (newsObj.id || '').trim() || '0';

  // ✅ A) localStorage view++
  const nextViews = bumpLocalNewsViews(realId);

  // ✅ list-тағы pill санын да жаңартамыз
  const pill = document.getElementById(`newsViews_${realId}`);
  if (pill) {
    const span = pill.querySelector('span');
    if (span) span.textContent = String(nextViews);
  }

  // ---- қалған сенің кодың ----
  state.selectedNews = newsObj;

  const t = document.getElementById('newsDetailTitle');
  const d = document.getElementById('newsDetailDate');
  const tx = document.getElementById('newsDetailText');
  const linksBox = document.getElementById('newsDetailLinks');

  if (t) t.textContent = newsObj.title || 'Жаңалық';
  if (d) d.textContent = newsObj.date || '';
  if (tx) tx.textContent = newsObj.text || '';

  const links = parseLinks(newsObj.link || newsObj.links || newsObj.url || '');

  if (linksBox) {
    if (!links.length) {
      linksBox.style.display = 'none';
      linksBox.innerHTML = '';
    } else {
      linksBox.style.display = 'block';
      linksBox.innerHTML = `
        <div class="news-links">
          ${links.map(l => `
            <a class="news-link-btn" href="${l.url}" target="_blank" rel="noopener">
              <i class="fas fa-link"></i> ${l.title}
            </a>
          `).join('')}
        </div>
      `;
    }
  }

  showPage('newsDetailPage');
  saveState();
}

  state.selectedNews = newsObj;

  const t = document.getElementById('newsDetailTitle');
  const d = document.getElementById('newsDetailDate');
  const tx = document.getElementById('newsDetailText');
  const linksBox = document.getElementById('newsDetailLinks');

  if (t) t.textContent = newsObj.title || 'Жаңалық';
  if (d) d.textContent = newsObj.date || '';
  if (tx) tx.textContent = newsObj.text || '';

  // Links (optional): sheet-та "link" немесе "links" бағаны болса
  const links = parseLinks(newsObj.link || newsObj.links || newsObj.url || '');

  if (linksBox) {
    if (!links.length) {
      linksBox.style.display = 'none';
      linksBox.innerHTML = '';
    } else {
      linksBox.style.display = 'block';
      linksBox.innerHTML = `
        <div class="news-links">
          ${links.map(l => `
            <a class="news-link-btn" href="${l.url}" target="_blank" rel="noopener">
              <i class="fas fa-link"></i> ${l.title}
            </a>
          `).join('')}
        </div>
      `;
    }
  }

  showPage('newsDetailPage');
  saveState();
}



    // ===== THEME FUNCTIONS =====
    function changeTheme(theme) {
  if (theme === 'dark') {
    document.body.classList.add('theme-dark');
  } else {
    document.body.classList.remove('theme-dark');
  }
  localStorage.setItem('theme', theme);

  // toggle sync
  const tg = document.getElementById('themeToggle');
  if (tg) tg.checked = (theme === 'dark');
  syncThemeLabels();
}

function syncThemeLabels(){
  const left = document.getElementById('themeLabelLeft');
  const right = document.getElementById('themeLabelRight');
  const isDark = document.body.classList.contains('theme-dark');

  if (left) left.classList.toggle('active', !isDark);
  if (right) right.classList.toggle('active', isDark);
}

    // ===== GOOGLE SHEETS FUNCTIONS =====
    function extractGoogleDriveId(url) {
      if (!url) return null;
      const patterns = [
        /\/d\/([A-Za-z0-9_-]+)/,
        /\/file\/d\/([A-Za-z0-9_-]+)/,
        /id=([A-Za-z0-9_-]+)/,
        /([A-Za-z0-9_-]{25,})/
      ];
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match && match[1]) return match[1];
      }
      return null;
    }

    async function fetchSheetData(sheet) {
      const url = `https://docs.google.com/spreadsheets/d/${CONFIG.spreadsheetId}/gviz/tq?sheet=${encodeURIComponent(sheet)}&tqx=out:json`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(res.status);
      const text = await res.text();
      const json = JSON.parse(text.slice(text.indexOf('{'), text.lastIndexOf('}') + 1));
      return json.table.rows.map(r => {
        const obj = {};
        r.c.forEach((cell, i) => {
          const key = json.table.cols[i].label.trim();
          obj[key] = cell && cell.v != null ? String(cell.v).trim() : '';
        });
        return obj;
      });
    }

    async function loadModulesWithCounts() {
      try {
        const [modules, lessons] = await Promise.all([
          fetchSheetData(CONFIG.sheets.modules),
          fetchSheetData(CONFIG.sheets.lessons)
        ]);

        state.modules = modules;
        state.lessonsAll = lessons;
        state.lessonsFetchedAt = Date.now();

        const counts = lessons.reduce((a, l) => {
          const m = String(l.module_id);
          a[m] = (a[m] || 0) + 1;
          return a;
        }, {});

        renderModules(modules, counts);
      } catch (err) {
        console.error('Модульдерді жүктеу қатесі:', err);
        DOM.coursesContainer.innerHTML = `
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Модульдерді жүктеу мүмкін емес</h3>
            <p>Кейінірек қайталап көріңіз</p>
          </div>`;
      }
    }

    function renderModules(modules, lessonCounts) {
  DOM.coursesContainer.innerHTML = '';
  DOM.coursesContainer.className = 'academy-modules-grid';

  // ✅ paid = is_active=1, bonus = is_active=0
  const filtered = (modules || []).filter(m => {
    const a = String(m.is_active ?? '').trim(); // "1" or "0"
    if (state.coursesTab === 'paid') return a === '1';
    if (state.coursesTab === 'bonus') return a === '0';
    return true;
  });

  if (!filtered.length) {
    DOM.coursesContainer.innerHTML = `
      <div class="error-message" style="grid-column:1/-1;">
        <i class="fas fa-inbox"></i>
        <h3>Әзірше курс жоқ</h3>
        <p>${state.coursesTab === 'paid' ? 'Ақылы курстар кейін қосылады' : 'Бонус курстар кейін қосылады'}</p>
      </div>`;
    return;
  }

  filtered.forEach((mod, i) => {
    const count = lessonCounts[String(mod.id)] || 0;
    const isPaid = String(mod.is_active ?? '').trim() === '1'; // paid => login керек
    const img = (mod.image_url || mod.image || '').trim();
    const safeImg = img ? img.replace(/'/g, "\\'") : '';
    const bgStyle = img ? `style="background-image:url('${safeImg}');"` : '';

    const card = document.createElement('div');
    card.className = 'academy-card fade-in';
    card.style.animationDelay = `${i * 0.1}s`;

    card.innerHTML = `
      <div class="academy-card-image module-bg ${img ? 'is-image' : ''}" ${bgStyle}>
        ${img ? '' : `<div class="module-label">${mod.name || ''}</div>`}
      </div>

      <div class="academy-card-content">
        <h3>${mod.name || ''}</h3>
        <p>${mod.description || ''}</p>

        <p style="margin-top:8px; color:var(--brand); font-weight:600;">
          Сабақ саны: ${count}
        </p>

        <button class="btn ${isPaid ? 'btn-primary' : 'btn-secondary'} view-lessons"
          data-module-id="${mod.id}"
          data-is-paid="${isPaid ? '1' : '0'}"
          data-module-name="${encodeURIComponent(mod.name || '')}"
          data-module-description="${encodeURIComponent(mod.description || '')}">
          <i class="fas ${isPaid ? 'fa-lock' : 'fa-gift'}"></i>
          ${isPaid ? (mod.price ? `${mod.price} ₸` : 'Курсты көру (кіру керек)') : 'Бонус сабақтарды көру'}
        </button>
      </div>
    `;

    DOM.coursesContainer.appendChild(card);
  });

  document.querySelectorAll('.view-lessons').forEach(btn => {
    btn.addEventListener('click', () => {
      const moduleId = btn.dataset.moduleId;
      const isPaid = btn.dataset.isPaid === '1';
      const moduleName = decodeURIComponent(btn.dataset.moduleName || '');
      const moduleDescription = decodeURIComponent(btn.dataset.moduleDescription || '');

      // ✅ Paid болса — логин міндетті
      if (isPaid && !state.currentUser) {
        showAuthGate({
          title: 'Ақылы модуль',
          text: 'Модульге кіру үшін алдымен аккаунтқа кіріңіз. Егер курсты сатып алмаған болсаңыз, төлем жасап, чекті WhatsApp-қа жіберіңіз — қолжетімділікті қосамыз.',
          waText: `Сәлеметсіз бе! "${moduleName}" модуліне доступ керек. Чек жіберемін.`
        });
        return;
      }

      state.currentModule = {
        id: moduleId,
        name: moduleName,
        description: moduleDescription,
        isPaid
      };

      DOM.lessonPageTitle.textContent = moduleName;
      DOM.moduleTitle.textContent = `${moduleName} модулінің сабақтары`;
      DOM.moduleDescription.textContent = moduleDescription;

      showPage('lessonsPage');
      saveState();
    });
  });
}


function showAuthGate(opts = {}) {
  const m = document.getElementById('authGateModal');
  if (!m) return;

  // мәтін
  const title = document.getElementById('authGateTitle');
  const text  = document.getElementById('authGateText');
  if (title) title.textContent = opts.title || 'Ақылы модуль';
  if (text)  text.textContent  = opts.text  || 'Бұл бөлімді көру үшін аккаунтқа кіру керек.';

  // whatsapp link
  const wa = opts.whatsapp || '77771589606';
  const waLink = document.getElementById('authGateWaLink');
  if (waLink) waLink.href = `https://wa.me/${wa}${opts.waText ? `?text=${encodeURIComponent(opts.waText)}` : ''}`;

  m.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function hideAuthGate() {
  const m = document.getElementById('authGateModal');
  if (!m) return;
  m.classList.remove('active');
  document.body.style.overflow = '';
}

function goToLoginFromGate(){
  hideAuthGate();
  showLoginModal();
}

// сыртынан басса жабу
document.addEventListener('click', (e)=>{
  const m = document.getElementById('authGateModal');
  if (m && m.classList.contains('active') && e.target === m) hideAuthGate();
});


function getLocalNewsViews(newsId){
  const key = `news_views_${newsId}`;
  return parseInt(localStorage.getItem(key) || '0', 10);
}

function bumpLocalNewsViews(newsId){
  const key = `news_views_${newsId}`;
  const next = getLocalNewsViews(newsId) + 1;
  localStorage.setItem(key, String(next));
  return next;
}


    function loadModules() {
      loadModulesWithCounts();
      showPage('mainPage');
    }

    // ===== PAYMENT FUNCTIONS =====
    function showPaymentOptions(moduleId, moduleName, moduleDescription) {
      const modalContent = `
        <div class="modal-header">
          <h3>Курсты сатып алу</h3>
          <p>"${moduleName}" курсын сатып алыңыз</p>
        </div>
        <div style="margin-bottom: 20px;">
          <p style="color: var(--text-secondary); margin-bottom: 15px;">Курсты сатып алу үшін:</p>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <a href="https://pay.kaspi.kz/pay" class="btn btn-primary" target="_blank" style="text-align: center;">
              <i class="fas fa-link"></i> Kaspi Pay арқылы төлеу
            </a>
            <a href="https://wa.me/77479894879?text=${encodeURIComponent(`Сәлеметсіз бе! "${moduleName}" курсын сатып алғым келеді.`)}" 
               class="btn btn-secondary" target="_blank" style="text-align: center;">
              <i class="fab fa-whatsapp"></i> Менеджерге жазу
            </a>
          </div>
        </div>
        <div style="background: var(--bg-secondary); padding: 15px; border-radius: var(--radius); margin-bottom: 20px;">
          <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Төлем нұсқаулығы:</p>
          <ol style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
            <li>Kaspi Pay арқылы төлеңіз</li>
            <li>Төлем чегін WhatsApp арқылы менеджерге жіберіңіз</li>
            <li>Менеджер сізге қолжетімділікті қосады</li>
          </ol>
        </div>
        <button class="btn btn-secondary btn-block" onclick="hideCustomModal()">
          <i class="fas fa-times"></i> Жабу
        </button>
      `;
      
      showCustomModal(modalContent);
    }

    // ===== LESSONS FUNCTIONS =====
    async function loadLessons(moduleId) {
      DOM.lessonsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Сабақтар жүктелуде...</p></div>';
      DOM.lessonsContainer.className = 'academy-modules-grid';

      // ВАЖНО: Изменена логика проверки доступа
      // Если пользователь залогинен и включен режим тестирования, даем доступ ко всем курсам
      // ✅ Module type: paid/bonus (bonus = is_active 0 => login жоқ)
const isPaidModule = !!(state.currentModule && state.currentModule.isPaid);

// ✅ BONUS болса — бәріне рұқсат (логинсіз де)
if (!isPaidModule) {
  // fresh cache check
  const needRefresh = !Array.isArray(state.lessonsAll) ||
    (Date.now() - state.lessonsFetchedAt > 2 * 60 * 1000);

  try {
    if (needRefresh) {
      const fresh = await fetchSheetData(CONFIG.sheets.lessons);
      state.lessonsAll = fresh;
      state.lessonsFetchedAt = Date.now();
    }

    const subset = state.lessonsAll.filter(x => String(x.module_id) === String(moduleId));
    state.currentModuleLessons = subset;
    renderLessons(subset);
    return;
  } catch (e) {
    console.error('Сабақтарды жүктеу қатесі:', e);
    DOM.lessonsContainer.innerHTML =
      '<div class="error-message"><i class="fas fa-exclamation-triangle"></i><h3>Сабақтарды жүктеу мүмкін емес</h3></div>';
    return;
  }
}

// ✅ PAID болса — логин + сатып алу керек
const isPurchased = state.currentUser && ALLOW_ALL_COURSES_FOR_LOGGED_IN
  ? true
  : (state.currentUser?.purchasedCourses?.includes(parseInt(moduleId)) || false);

  if (!state.currentUser) {
  showAuthGate({
    title: 'Ақылы модуль',
    text: 'Сабақтарды көру үшін аккаунтқа кіру керек. Кірген соң модуль ашылады.',
    waText: `Сәлеметсіз бе! "${state.currentModule?.name || ''}" модуліне доступ керек.`
  });
  return;
}

if (!isPurchased) {
  DOM.lessonsContainer.innerHTML = `
    <div class="error-message" style="grid-column: 1 / -1;">
      <i class="fas fa-lock" style="font-size: 3rem; margin-bottom: 20px; color: var(--error);"></i>
      <h3>Бұл модульге қолжетім жоқ</h3>
      <p style="margin-bottom: 20px;">Бұл модульді көру үшін курсты сатып алуыңыз керек</p>
      <button class="btn btn-primary" onclick="showPaymentOptions('${moduleId}', '${state.currentModule?.name || ''}', '${state.currentModule?.description || ''}')">
        <i class="fas fa-shopping-cart"></i> Курсты сатып алу
      </button>
    </div>`;
  return;
}

// ✅ Access OK → сабақты жүктеу (төмендегі сенің кодың қала береді)

      // User has access, load lessons
      const needRefresh = !Array.isArray(state.lessonsAll) ||
        (Date.now() - state.lessonsFetchedAt > 2 * 60 * 1000);
      
      if (needRefresh) {
        try {
          const fresh = await fetchSheetData(CONFIG.sheets.lessons);
          state.lessonsAll = fresh;
          state.lessonsFetchedAt = Date.now();
          const subset = fresh.filter(x => String(x.module_id) === String(moduleId));
          state.currentModuleLessons = subset;
          renderLessons(subset);
        } catch (e) {
          console.error('Сабақтарды жүктеу қатесі:', e);
          DOM.lessonsContainer.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i><h3>Сабақтарды жүктеу мүмкін емес</h3></div>';
        }
      } else {
        const subset = state.lessonsAll.filter(x => String(x.module_id) === String(moduleId));
        state.currentModuleLessons = subset;
        renderLessons(subset);
      }
    }

    function renderLessons(lessons) {
  if (!lessons.length) {
    DOM.lessonsContainer.innerHTML = `
      <div class="error-message">
        <i class="fas fa-video"></i>
        <h3>Сабақтар табылмады</h3>
        <p>Әзірше осы модульге сабақ жоқ</p>
      </div>`;
    return;
  }

  DOM.lessonsContainer.innerHTML = '';
  lessons.forEach((l, i) => {
    const img = (l.image_url || l.cover || '').trim();
    const bgStyle = img ? `style="background-image:url('${img.replace(/'/g, "\\'")}');"` : '';

    const card = document.createElement('div');
    card.className = 'academy-card fade-in';
    card.style.animationDelay = `${i * 0.1}s`;

    card.innerHTML = `
      <div class="academy-card-image ${img ? 'is-image' : 'lesson-bg'}" ${bgStyle}>
        ${img ? '' : `<div class="lesson-number">${i + 1}</div>`}
      </div>

      <div class="academy-card-content">
        <h3>${l.name}</h3>
        <p>${l.description}</p>
        <div style="display:flex; gap:12px; margin-top:20px;">
          <button class="btn btn-primary play-video"
                  data-lesson-id="${l.id}"
                  data-lesson-index="${i}"
                  data-video-url="${l.video_url || ''}"
                  data-lesson-title="${encodeURIComponent(l.name)}">
            <i class="fas fa-play-circle"></i> Қарау
          </button>
          ${l.pdf_url ? `<a href="${l.pdf_url}" class="btn btn-secondary" target="_blank"><i class="fas fa-file-pdf"></i> Презентация</a>` : ''}
        </div>
      </div>
    `;

    DOM.lessonsContainer.appendChild(card);
  });

  document.querySelectorAll('.play-video').forEach(btn => {
    btn.addEventListener('click', () => playVideo(btn));
  });
}

    // ===== VIDEO PLAYER FUNCTIONS =====
    function playVideo(button) {
      const lessonIndex = parseInt(button.dataset.lessonIndex);
      const videoUrl = button.dataset.videoUrl;
      const lessonTitle = decodeURIComponent(button.dataset.lessonTitle);
      const driveId = extractGoogleDriveId(videoUrl);
      
      if (!driveId) {
        showNotification('Бейне табылмады', 'error');
        return;
      }
      
      state.currentVideo = { 
        id: driveId, 
        title: lessonTitle,
        index: lessonIndex 
      };
      
      // Update video player
      DOM.videoTitle.textContent = lessonTitle;
      DOM.videoLessonTitle.textContent = lessonTitle;
      DOM.videoPlayer.src = `https://drive.google.com/file/d/${driveId}/preview`;
      
      // Show/hide navigation buttons
      if (state.currentModuleLessons.length > 1) {
        DOM.videoNavigation.style.display = 'flex';
        DOM.prevVideoBtn.style.display = lessonIndex > 0 ? 'block' : 'none';
        DOM.nextVideoBtn.style.display = lessonIndex < state.currentModuleLessons.length - 1 ? 'block' : 'none';
      } else {
        DOM.videoNavigation.style.display = 'none';
      }
      
      // Show video player
      DOM.videoPlayerPage.style.display = 'flex';
      
      // Load comments
      loadComments(driveId);
      
      // Save state
      saveState();
    }

    function playVideoById(lessonId) {
      const lessonIndex = state.currentModuleLessons.findIndex(l => l.id === lessonId);
      if (lessonIndex !== -1) {
        const lesson = state.currentModuleLessons[lessonIndex];
        const driveId = extractGoogleDriveId(lesson.video_url);
        
        if (driveId) {
          state.currentVideo = {
            id: driveId,
            title: lesson.name,
            index: lessonIndex
          };
          
          DOM.videoTitle.textContent = lesson.name;
          DOM.videoLessonTitle.textContent = lesson.name;
          DOM.videoPlayer.src = `https://drive.google.com/file/d/${driveId}/preview`;
          
          // Show/hide navigation buttons
          if (state.currentModuleLessons.length > 1) {
            DOM.videoNavigation.style.display = 'flex';
            DOM.prevVideoBtn.style.display = lessonIndex > 0 ? 'block' : 'none';
            DOM.nextVideoBtn.style.display = lessonIndex < state.currentModuleLessons.length - 1 ? 'block' : 'none';
          } else {
            DOM.videoNavigation.style.display = 'none';
          }
          
          // Load comments
          loadComments(driveId);
          
          // Save state
          saveState();
        }
      }
    }

    function playNextVideo() {
      if (state.currentVideo && state.currentVideo.index < state.currentModuleLessons.length - 1) {
        const nextIndex = state.currentVideo.index + 1;
        const nextLesson = state.currentModuleLessons[nextIndex];
        playVideoById(nextLesson.id);
      }
    }

    function playPrevVideo() {
      if (state.currentVideo && state.currentVideo.index > 0) {
        const prevIndex = state.currentVideo.index - 1;
        const prevLesson = state.currentModuleLessons[prevIndex];
        playVideoById(prevLesson.id);
      }
    }

    function closeVideo() {
      // Stop video
      DOM.videoPlayer.src = '';
      
      // Hide video player
      DOM.videoPlayerPage.style.display = 'none';
      
      // Clear comment input
      if (DOM.commentInput) {
        DOM.commentInput.value = '';
      }
    }

    // ===== COMMENTS FUNCTIONS =====
    async function loadComments(videoId) {
      DOM.commentsList.innerHTML = '<div class="loading"><div class="spinner"></div><p>Пікірлер жүктелуде...</p></div>';
      
      try {
        const all = await fetchSheetData(CONFIG.sheets.comments);
        console.log('All comments:', all); // Debug
        const comments = all.filter(c => String(c.video_id) === String(videoId));
        console.log('Filtered comments:', comments); // Debug
        
        if (comments.length === 0) {
          DOM.commentsList.innerHTML = '<div class="comment-card"><p style="color: var(--text-muted); text-align: center;">Әзірше пікір жоқ</p></div>';
        } else {
          DOM.commentsList.innerHTML = comments.map(comment => `
            <div class="comment-card">
              <div class="comment-header">
                <div class="comment-avatar">
                  ${comment.user ? comment.user.charAt(0).toUpperCase() : '?'}
                </div>
                <div>
                  <div class="comment-author">${comment.user || 'Қолданушы'}</div>
                  <div class="comment-date">${comment.date || ''}</div>
                </div>
              </div>
              <div class="comment-text">${comment.comment || ''}</div>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Пікірлерді жүктеу қатесі:', error);
        DOM.commentsList.innerHTML = '<div class="comment-card"><p style="color: var(--error); text-align: center;">Пікірлерді жүктеу мүмкін емес</p></div>';
      }
    }

    async function addComment() {
      if (!state.currentVideo || !DOM.commentInput) return;
      
      const text = DOM.commentInput.value.trim();
      if (!text) {
        showNotification('Пікірді енгізіңіз', 'error');
        return;
      }
      
      if (!state.currentUser) {
        showNotification('Пікір қалдыру үшін кіріңіз', 'error');
        showLoginModal();
        return;
      }
      
      try {
        const url = COMMENT_URL + `?action=add&video_id=${encodeURIComponent(state.currentVideo.id)}&user=${encodeURIComponent(state.currentUser.name)}&comment=${encodeURIComponent(text)}`;
        console.log('Sending comment to:', url); // Debug
        const response = await fetch(url);
        const result = await response.json();
        console.log('Comment response:', result); // Debug
        
        if (result.status === 'success') {
          showNotification('Пікіріңіз қосылды!', 'success');
          DOM.commentInput.value = '';
          loadComments(state.currentVideo.id);
        } else {
          showNotification('Пікір қосу қатесі', 'error');
        }
      } catch (error) {
        console.error('Пікір қосу қатесі:', error);
        showNotification('Пікір қосу мүмкін емес', 'error');
      }
    }

    // ===== AUTH FUNCTIONS =====
    async function checkAuth() {
      const user = localStorage.getItem('eduplatform_user');
      if (user) {
        try {
          state.currentUser = JSON.parse(user);
          // Verify session
          const ok = await verifySession();
          if (ok) {
            updateUserUI();
            startHeartbeat();
            // Refresh modules to show purchased status
            loadModulesWithCounts();
          } else {
            forceLogout('Сессия аяқталды');
          }
        } catch (error) {
          console.error('Аутентификация қатесі:', error);
          forceLogout();
        }
      }
    }

    async function login() {
      const phone = document.getElementById('phoneInput').value;
      const password = document.getElementById('passwordInput').value;
      
      if (!phone || !password) {
        showNotification('Барлық өрістерді толтырыңыз', 'error');
        return;
      }
      
      try {
        const url = `${SESS_URL}?action=login&login=${encodeURIComponent(phone)}&password=${encodeURIComponent(password)}`;
        const res = await fetch(url);
        const data = await res.json();
        
        console.log('Login response:', data); // Для отладки
        
        if (data.ok) {
          // ВАЖНО: В тестовом режиме даем доступ ко всем курсам
          // В реальном режиме нужно использовать data.purchasedCourses
          const purchasedCourses = ALLOW_ALL_COURSES_FOR_LOGGED_IN 
            ? state.modules.map(m => parseInt(m.id)) // Даем доступ ко всем курсам
            : (data.purchasedCourses || []);
          
          state.currentUser = { 
            name: data.name || phone, 
            login: phone, 
            token: data.token,
            purchasedCourses: purchasedCourses
          };
          
          localStorage.setItem('eduplatform_user', JSON.stringify(state.currentUser));
          updateUserUI();
          hideLoginModal();
          showNotification('Сәтті кірдіңіз! Сіз курстарды қарай аласыз.', 'success');
          startHeartbeat();
          
          // Refresh modules to show purchased status
          loadModulesWithCounts();
          
          // Execute post-login action if any
          if (state.postLoginAction) {
            state.postLoginAction();
            state.postLoginAction = null;
          }
        } else if (data.error === 'expired') {
          showNotification('Қол жеткізу мерзімі аяқталды. Доступты жаңартыңыз.', 'error');
        } else {
          showNotification('Қате логин немесе құпиясөз', 'error');
        }
      } catch (error) {
        console.error('Кіру қатесі:', error);
        showNotification('Сервер қолжетімсіз', 'error');
      }
    }

    async function verifySession() {
      if (!state.currentUser) return false;
      
      try {
        const res = await fetch(
          `${SESS_URL}?action=verify&login=${encodeURIComponent(state.currentUser.login)}&token=${encodeURIComponent(state.currentUser.token)}`,
          { cache: 'no-store' }
        );
        const data = await res.json();
        return !!data.ok;
      } catch {
        return false;
      }
    }

    function startHeartbeat() {
      if (sessionTimer) clearInterval(sessionTimer);
      
      sessionTimer = setInterval(async () => {
        if (!state.currentUser) return;
        
        try {
          const ok = await verifySession();
          if (!ok) {
            forceLogout('Сессия аяқталды');
          }
        } catch {
          // Ignore heartbeat errors
        }
      }, 30000);
    }

    function forceLogout(message) {
      if (state.currentUser) {
        fetch(`${SESS_URL}?action=logout&login=${encodeURIComponent(state.currentUser.login)}&token=${encodeURIComponent(state.currentUser.token)}`)
          .catch(() => {});
      }
      
      localStorage.removeItem('eduplatform_user');
      state.currentUser = null;
      
      if (sessionTimer) {
        clearInterval(sessionTimer);
        sessionTimer = null;
      }
      
      updateUserUI();
      
      if (message) {
        showNotification(message, 'info');
      }
      
      // Refresh modules to show lock status
      loadModulesWithCounts();
    }

    function logout() {
      forceLogout('Сіз жүйеден шықтыңыз');
    }

    function updateUserUI() {
      const isLoggedIn = !!state.currentUser;
      
      if (DOM.userName) {
        DOM.userName.textContent = isLoggedIn ? state.currentUser.name : 'Қонақ';
      }
      
      if (DOM.userEmail) {
        DOM.userEmail.textContent = isLoggedIn ? state.currentUser.login : 'Кіру керек';
      }
      
      if (DOM.profileAvatar && isLoggedIn && state.currentUser.name) {
        DOM.profileAvatar.innerHTML = state.currentUser.name.charAt(0).toUpperCase();
      }
      
      if (DOM.logoutBtn) {
        DOM.logoutBtn.style.display = isLoggedIn ? 'block' : 'none';
      }
      
      if (DOM.loginBtn) {
        DOM.loginBtn.style.display = isLoggedIn ? 'none' : 'block';
      }
      
      if (DOM.loginButtonHeader) {
        DOM.loginButtonHeader.style.display = isLoggedIn ? 'none' : 'inline-flex';
      }
      
      // Update stats if logged in
      if (isLoggedIn) {
        const purchasedCount = state.currentUser.purchasedCourses?.length || 0;
        DOM.statCourses.textContent = purchasedCount;
        DOM.statLessons.textContent = state.lessonsAll.filter(l => 
          state.currentUser.purchasedCourses?.includes(parseInt(l.module_id))
        ).length;
    
        
        updateMyCourses();
      } else {
        DOM.statCourses.textContent = '0';
        DOM.statLessons.textContent = '0';
        DOM.myCourses.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">Әзірше курс сатып алмадыңыз</p>';
      }
    }

    function updateMyCourses() {
      if (!state.currentUser || !state.currentUser.purchasedCourses) return;
      
      const purchasedModules = state.modules.filter(m => 
        state.currentUser.purchasedCourses.includes(parseInt(m.id))
      );
      
      if (purchasedModules.length === 0) {
        DOM.myCourses.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">Әзірше курс сатып алмадыңыз</p>';
        return;
      }
      
      DOM.myCourses.innerHTML = purchasedModules.map(module => `
        <div style="padding: 12px; border-bottom: 1px solid var(--border);">
          <h4 style="margin-bottom: 4px;">${module.name}</h4>
          <p style="font-size: 14px; color: var(--text-muted);">${module.description}</p>
          <button class="btn btn-primary" style="margin-top: 8px; font-size: 14px; padding: 8px 16px;"
                  onclick="openModule(${module.id})">
            <i class="fas fa-book-reader"></i> Жалғастыру
          </button>
        </div>
      `).join('');
    }

    function updateProfilePage() {
      updateUserUI();
    }

    // Open module from profile
    function openModule(moduleId) {
      const module = state.modules.find(m => m.id == moduleId);
      if (!module) return;

      state.currentModule = {
        id: module.id,
        name: module.name,
        description: module.description,
        isPaid: String(module.is_active ?? '').trim() === '1'
      };

      DOM.lessonPageTitle.textContent = module.name;
      DOM.moduleTitle.textContent = `${module.name} модулінің сабақтары`;
      DOM.moduleDescription.textContent = module.description;

      showPage('lessonsPage');
      saveState();
    }

    // ===== MODAL FUNCTIONS =====
    function showLoginModal() {
      DOM.loginModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function hideLoginModal() {
      DOM.loginModal.classList.remove('active');
      document.body.style.overflow = '';
      document.getElementById('phoneInput').value = '';
      document.getElementById('passwordInput').value = '';
    }

    function showCustomModal(content) {
      DOM.customModalContent.innerHTML = content;
      DOM.customModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function hideCustomModal() {
      DOM.customModal.classList.remove('active');
      document.body.style.overflow = '';
    }

    function showPrivacyPolicy() {
      const content = `
        <div class="modal-header">
          <h3>Privacy Policy</h3>
          <p>Жеке деректерді қорғау саясаты</p>
        </div>
        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
          <p>Біз сіздің жеке деректеріңізді қорғаймыз...</p>
          <!-- Add your privacy policy content here -->
        </div>
        <button class="btn btn-secondary btn-block" onclick="hideCustomModal()">
          <i class="fas fa-times"></i> Жабу
        </button>
      `;
      showCustomModal(content);
    }

    function showTerms() {
      const content = `
        <div class="modal-header">
          <h3>Terms of Service</h3>
          <p>Қызмет көрсету шарттары</p>
        </div>
        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
          <p>Қызметті пайдалану шарттары...</p>
          <!-- Add your terms of service content here -->
        </div>
        <button class="btn btn-secondary btn-block" onclick="hideCustomModal()">
          <i class="fas fa-times"></i> Жабу
        </button>
      `;
      showCustomModal(content);
    }

    // ===== FAQ FUNCTIONS =====
    function toggleFaq(element) {
      element.classList.toggle('active');
    }

    // ===== NOTIFICATION FUNCTIONS =====
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(120%)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== EVENT LISTENERS SETUP =====
    function setupEventListeners() {
      // Close modal when clicking outside
      DOM.loginModal.addEventListener('click', (e) => {
        if (e.target === DOM.loginModal) {
          hideLoginModal();
        }
      });

      DOM.customModal.addEventListener('click', (e) => {
        if (e.target === DOM.customModal) {
          hideCustomModal();
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (DOM.loginModal.classList.contains('active')) {
            hideLoginModal();
          }
          if (DOM.customModal.classList.contains('active')) {
            hideCustomModal();
          }
          if (DOM.videoPlayerPage.style.display === 'flex') {
            closeVideo();
          }
        }
      });

      // Enter key to submit comment
      if (DOM.commentInput) {
        DOM.commentInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && e.ctrlKey) {
            addComment();
          }
        });
      }

      // Save state before page refresh
      window.addEventListener('beforeunload', saveState);
    }

    // ===== GLOBAL FUNCTIONS =====
    window.showPage = showPage;
    window.setCoursesTab = setCoursesTab;
    window.showLoginModal = showLoginModal;
    window.toggleFaq = toggleFaq;
    window.closeVideo = closeVideo;
    window.addComment = addComment;
    window.logout = logout;
    window.loadModules = loadModules;
    window.openModule = openModule;
    window.hideCustomModal = hideCustomModal;
    window.changeTheme = changeTheme;
    window.showPrivacyPolicy = showPrivacyPolicy;
    window.showTerms = showTerms;
  </script>
</body>
</html>